# SCR4 PV-Assistance Project, Jack Heseltine

![image](https://github.com/heseltime/php-myseql-pv-assistance/assets/66922223/ae0379f5-cce3-43df-af7d-840b12b29282)

Based on php-mysql-bookstore-dev-8 sample project, FHOOe/Hagenberg SCR4 2023.

### Test-Login (admin)

#### user: 'admin'
#### password: 'admin'

### DDEV Instructions

```
ddev import-db --src=db/pv-assistance.sql
ddev describe
ddev start
ddev stop
```

### URLs

#### home: https://pv-assistance.ddev.site/

#### phpmyadmin: https://pv-assistance.ddev.site:8037/

## Idea/Project Description and Architecture

### Idea

The core architectural idea is a no-credentials log in for the application part, so it is accessible, and a protected area for Sachbearbeiter. The "Sachbearbeiter" (admin) can log in with their credentials and have access to the protected area. The admin can then create, read, update and delete data from the database.

![image](https://github.com/heseltime/php-myseql-pv-assistance/assets/66922223/c25edf32-95a6-47ed-8325-3312e5df2b67)

The main application-UI is the form for submission, for admins it is a simple UI allowing status updates and data manipulation (accepted or rejected, optionally notes). There is also a token-protected area for getting the latest version of the application, for the applicant.

### Architecture

The major component is an application form submitted to the Controller (POST-request) to handle input checks server-side, as specified, and either display feedback or a submission confirmation for the application. The DataManager handles writing to the database when all input checks have passed (createUser(), createApplication()): the central element is construction php objects from the query results, and vice versa. These can then also be accessed in the Controller.

Input-Error Case:

![image](https://github.com/heseltime/php-myseql-pv-assistance/assets/66922223/e8412ec6-b233-49ab-a9ee-57df7386e1d0)

Success-Case:

![image](https://github.com/heseltime/php-myseql-pv-assistance/assets/66922223/63dbae64-358f-4e9f-bc4e-a3f42dc37e0c)

Everything is also tracked per user and application, especially, including IP address:

![image](https://github.com/heseltime/php-myseql-pv-assistance/assets/66922223/7a66cbd6-9f87-44c0-8f34-7299339f0c14)

Admin log-in:

...

Header partial and login actions in the controller/DataManager implement the login functionality for admins. In the logged in state admins have an additional header link that allows them to access the forms for processing. (Admin sign up is out of scope, see existing admin database entries.)

Admin processing:

List view:

...

A click on the edit button links to checkStatus tailored to admins, allowing for token processing and similar. The other side of the same view will be the user side.

...

The user is more limited in their options.

Application display once processed (with result):

(Approved case:)

![image](https://github.com/heseltime/php-myseql-pv-assistance/assets/66922223/e2c71e0f-8e70-485c-842b-13d787ed40de)

(Rejected case:)

![image](https://github.com/heseltime/php-myseql-pv-assistance/assets/66922223/71f8dcaf-9e9b-42f5-968e-acedb73c0cd8)

For completeness, in progress can also be called and looks like this:

![image](https://github.com/heseltime/php-myseql-pv-assistance/assets/66922223/489de95e-168d-4332-85b8-69e56d2e8e39)

### Security: UUID Mechanism

The access URL is encoded in the following snippet.

```
// 32 bits for "time_low"
mt_rand(0, 0xffff), mt_rand(0, 0xffff),

// 16 bits for "time_mid"
mt_rand(0, 0xffff),

// 16 bits for "time_hi_and_version",
// four most significant bits holds version number 4
mt_rand(0, 0x0fff) | 0x4000,

// 16 bits, 8 bits for "clk_seq_hi_res",
// 8 bits for "clk_seq_low",
// two most significant bits holds zero and one for variant DCE1.1
mt_rand(0, 0x3fff) | 0x8000,

// 48 bits for "node"
mt_rand(0, 0xffff), mt_rand(0, 0xffff), mt_rand(0, 0xffff)
```


The code  generates a version 4 UUID (Universally Unique Identifier) using random numbers. UUIDs are 128-bit identifiers that are typically used to uniquely identify objects or entities in computer systems.

Here's a breakdown of the code:

The first line generates the "time_low" part of the UUID, which consists of 32 bits. It uses mt_rand(0, 0xffff) twice to generate two random 16-bit numbers.

The second line generates the "time_mid" part of the UUID, which is another 16 bits. It uses mt_rand(0, 0xffff) to generate a random 16-bit number.

The third line generates the "time_hi_and_version" part of the UUID, which is 16 bits as well. It combines a random 16-bit number generated by mt_rand(0, 0x0fff) with the version number 4 (represented by the bitwise OR operation | 0x4000).

The fourth line generates the "clk_seq_hi_res" and "clk_seq_low" parts of the UUID, which together make up 16 bits. It combines a random 14-bit number generated by mt_rand(0, 0x3fff) with the variant bits for DCE1.1 (represented by the bitwise OR operation | 0x8000).

The remaining three lines generate the "node" part of the UUID, which is 48 bits. They use mt_rand(0, 0xffff) three times to generate three random 16-bit numbers.

Overall, the code uses the mt_rand function to generate random numbers within specific ranges and combines them to form a version 4 UUID with the required format and structure.

### Security: Overall Concept

UUID and token provide two factors for security. The interface is:

(No-UUID case:)

![image](https://github.com/heseltime/php-myseql-pv-assistance/assets/66922223/ada433d4-0ea5-48ae-9bf0-5ad2365c2bdd)

(UUID-link followed correctly:)

![image](https://github.com/heseltime/php-myseql-pv-assistance/assets/66922223/247c0d7a-86f2-493c-b293-6f8f0e996ec0)

As specified, token- and UUID distribution are not implemented here. A simple separation of the two factors when sending (sending at different times) provides a good degree of security.

## DB-Structure (UML)

The basic structure reflected in the classes for this project is User for applicants, Admin for application reviewers, Application for applications, Log for logs.

...

## DB-Structure (SQL)

## Test Cases

Some major tests were already covered in the 
